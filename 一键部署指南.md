# 🚀 一键部署指南 - 完整版

## 📋 部署流程总览

```
1. 配置 GitHub (5分钟)
   ↓
2. 推送代码到 GitHub (2分钟)
   ↓
3. 连接 Cloudflare Pages (3分钟)
   ↓
4. 配置域名和邮件 (5分钟)
   ↓
5. 完成！访问 xieziji.shop
```

---

## 第一步：配置 GitHub（首次使用需要）

### 方式一：使用自动化脚本（推荐）

**双击运行：`setup-github.bat`**

脚本会自动帮你：
- ✅ 配置 Git 用户信息
- ✅ 选择认证方式
- ✅ 打开相关配置页面

### 方式二：手动配置

1. **安装 Git**（如果还没有）
   - 下载：https://git-scm.com/download/win
   - 安装后重启命令行

2. **配置 Git 用户信息**
   ```bash
   git config --global user.name "你的GitHub用户名"
   git config --global user.email "你的GitHub邮箱"
   ```

3. **创建 GitHub 账号**（如果还没有）
   - 访问：https://github.com
   - 点击 Sign up 注册

4. **创建新仓库**
   - 访问：https://github.com/new
   - 仓库名：`youxiang-temp-mail`
   - 选择：`Public`（公开）
   - **不要**勾选任何初始化选项
   - 点击 `Create repository`

5. **配置认证**（选择一种）

   **选项A：Personal Access Token（推荐）**
   - 访问：https://github.com/settings/tokens
   - 点击 `Generate new token` → `Generate new token (classic)`
   - 勾选 `repo` 权限
   - 点击 `Generate token`
   - **复制并保存** token（只显示一次！）

   **选项B：GitHub Desktop（最简单）**
   - 下载：https://desktop.github.com/
   - 安装并登录 GitHub 账号
   - 使用 GitHub Desktop 管理代码

---

## 第二步：推送代码到 GitHub

### 方式一：使用自动化脚本（推荐）

**双击运行：`deploy.bat`**

脚本会自动：
1. ✅ 初始化 Git 仓库
2. ✅ 添加所有文件
3. ✅ 提交更改
4. ✅ 配置远程仓库
5. ✅ 推送到 GitHub

**输入信息：**
- 提交说明：直接回车使用默认
- GitHub 仓库地址：`https://github.com/你的用户名/youxiang-temp-mail.git`

**认证：**
- 用户名：你的 GitHub 用户名
- 密码：你的 Personal Access Token（不是 GitHub 密码！）

### 方式二：使用 GitHub Desktop

1. 打开 GitHub Desktop
2. File → Add Local Repository
3. 选择项目文件夹：`d:\code\idea\ideaPrograms\youxiang`
4. 点击 `Publish repository`
5. 仓库名：`youxiang-temp-mail`
6. 取消勾选 `Keep this code private`
7. 点击 `Publish repository`

### 方式三：手动命令行

```bash
# 1. 初始化 Git
git init

# 2. 添加文件
git add .

# 3. 提交
git commit -m "Initial commit: 临时邮箱平台"

# 4. 添加远程仓库（替换成你的用户名）
git remote add origin https://github.com/你的用户名/youxiang-temp-mail.git

# 5. 推送
git branch -M main
git push -u origin main
```

---

## 第三步：部署到 Cloudflare Pages

### 1. 登录 Cloudflare

- 访问：https://dash.cloudflare.com
- 如果没有账号，先注册（免费）

### 2. 添加域名到 Cloudflare

1. 点击 `添加站点`
2. 输入：`xieziji.shop`
3. 选择 `Free` 计划
4. Cloudflare 会显示两个 DNS 服务器地址（类似）：
   ```
   ns1.cloudflare.com
   ns2.cloudflare.com
   ```

5. **修改域名 DNS 服务器**
   - 登录你购买域名的网站（如阿里云、腾讯云、GoDaddy等）
   - 找到域名管理 → DNS 设置
   - 修改 DNS 服务器为 Cloudflare 提供的地址
   - 保存（生效需要几分钟到24小时）

6. 回到 Cloudflare，点击 `完成，检查名称服务器`

### 3. 创建 Pages 项目

1. 在 Cloudflare 控制台，点击左侧 `Workers 和 Pages`
2. 点击 `创建应用程序`
3. 选择 `Pages` 标签
4. 点击 `连接到 Git`
5. 选择 `GitHub`，授权 Cloudflare 访问
6. 选择仓库：`youxiang-temp-mail`
7. 点击 `开始设置`

### 4. 配置构建设置

```
项目名称：youxiang-temp-mail
生产分支：main
框架预设：Next.js
构建命令：npm run build
构建输出目录：.next
根目录：/
环境变量：（暂时不需要）
```

5. 点击 `保存并部署`

### 5. 等待部署完成

- 首次部署需要 3-5 分钟
- 你会看到构建日志
- 完成后会显示：`Success! Your site is live!`
- 会得到一个临时域名：`youxiang-temp-mail.pages.dev`

---

## 第四步：配置自定义域名

### 1. 添加主域名

1. 在 Pages 项目页面，点击 `自定义域`
2. 点击 `设置自定义域`
3. 输入：`xieziji.shop`
4. 点击 `激活域`
5. Cloudflare 会自动添加 DNS 记录

### 2. 添加子域名（通配符）

1. 再次点击 `设置自定义域`
2. 输入：`*.xieziji.shop`
3. 点击 `激活域`

这样所有子域名都会指向你的应用：
- ✅ `cheyu.xieziji.shop`
- ✅ `yumail.xieziji.shop`
- ✅ `tempmail.xieziji.shop`
- ✅ `mail.xieziji.shop`

### 3. 等待 DNS 生效

- 通常 5-30 分钟
- 最多 24 小时
- 可以用 https://dnschecker.org 检查

---

## 第五步：配置邮件接收（重要！）

### 1. 启用 Email Routing

1. 在 Cloudflare 控制台，点击你的域名 `xieziji.shop`
2. 点击左侧 `Email` → `Email Routing`
3. 点击 `开始使用`
4. Cloudflare 会自动配置 MX 记录
5. 点击 `自动添加记录`

### 2. 创建 Email Worker

1. 点击 `Email Workers` 标签
2. 点击 `创建`
3. Worker 名称：`email-receiver`
4. 复制 `email-worker.js` 文件的内容
5. 粘贴到编辑器
6. 点击 `保存并部署`

### 3. 创建路由规则

1. 点击 `路由规则` 标签
2. 点击 `创建路由`
3. 配置：
   ```
   匹配类型：自定义地址
   表达式：*@*.xieziji.shop
   操作：发送到 Worker
   Worker：email-receiver
   ```
4. 点击 `保存`

### 4. 配置 KV 存储（可选但推荐）

1. 在 Cloudflare 控制台，点击 `Workers 和 Pages`
2. 点击 `KV`
3. 点击 `创建命名空间`
4. 名称：`EMAIL_STORAGE`
5. 点击 `添加`

6. 回到你的 Pages 项目
7. 点击 `设置` → `函数`
8. 点击 `KV 命名空间绑定`
9. 添加绑定：
   ```
   变量名：EMAIL_STORAGE
   KV 命名空间：EMAIL_STORAGE
   ```
10. 点击 `保存`

---

## 🎉 完成！

现在你可以访问：

- **主站**：https://xieziji.shop
- **子域名**：
  - https://cheyu.xieziji.shop
  - https://yumail.xieziji.shop
  - https://tempmail.xieziji.shop
  - https://mail.xieziji.shop

### 测试邮件接收

1. 在网站上生成一个临时邮箱，例如：`abc123@cheyu.xieziji.shop`
2. 用你的真实邮箱发送邮件到这个地址
3. 等待几秒钟，刷新页面
4. 应该能看到收到的邮件！

---

## 🔄 后续更新

每次修改代码后：

```bash
git add .
git commit -m "更新说明"
git push
```

Cloudflare Pages 会自动检测并重新部署！

---

## ❓ 常见问题

### Q1: 推送到 GitHub 失败？
**A:** 检查：
- Git 是否安装？运行 `git --version`
- 用户名和邮箱是否配置？
- Personal Access Token 是否正确？
- 网络是否正常？

### Q2: Cloudflare 构建失败？
**A:** 检查：
- Node.js 版本是否设置为 18？
- 构建命令是否正确？
- 查看构建日志找到具体错误

### Q3: 域名无法访问？
**A:** 
- DNS 是否已经切换到 Cloudflare？
- 等待 DNS 生效（最多24小时）
- 检查自定义域名是否正确添加

### Q4: 收不到邮件？
**A:** 检查：
- Email Routing 是否启用？
- MX 记录是否正确？
- Email Worker 是否部署？
- 路由规则是否配置？
- KV 存储是否绑定？

### Q5: 邮件显示不出来？
**A:**
- 打开浏览器开发者工具（F12）
- 查看 Console 是否有错误
- 检查 Network 标签，API 请求是否成功
- 确认 KV 存储已绑定

---

## 📞 需要帮助？

如果遇到问题：

1. 查看详细文档：`CLOUDFLARE_DEPLOY.md`
2. 检查 Cloudflare 构建日志
3. 查看浏览器控制台错误信息

---

## 🎯 下一步优化

部署成功后，你可以：

- [ ] 添加更多子域名
- [ ] 自定义界面样式
- [ ] 增加邮件过期时间
- [ ] 添加访问统计
- [ ] 配置自定义邮件规则

祝你部署顺利！🎉

