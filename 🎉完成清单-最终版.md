# ğŸ‰ ä¸´æ—¶é‚®ç®±é¡¹ç›® - å®Œæˆæ¸…å•ï¼ˆæœ€ç»ˆç‰ˆï¼‰

## âœ… å·²å®Œæˆçš„æ‰€æœ‰ä¿®å¤

### ğŸ“¦ **æäº¤ä¿¡æ¯**
- **Commit Hash**: `4ddcf00`
- **æäº¤æ—¶é—´**: åˆšåˆš
- **æäº¤æ¶ˆæ¯**: "ğŸ‰ å®Œæ•´ä¿®å¤ï¼šæ·»åŠ  API è·¯ç”± + ä¿®å¤ Cloudflare Pages é…ç½®"

---

## ğŸ”§ **ä¿®å¤çš„æ–‡ä»¶æ¸…å•**

### 1ï¸âƒ£ **next.config.js** âœ…
**é—®é¢˜**: ä½¿ç”¨äº† `output: 'export'` å¯¼è‡´ API è·¯ç”±æ— æ³•å·¥ä½œ

**ä¿®å¤**:
```javascript
// âŒ ä¹‹å‰ï¼ˆé”™è¯¯ï¼‰
output: 'export', // é™æ€å¯¼å‡ºæ¨¡å¼

// âœ… ç°åœ¨ï¼ˆæ­£ç¡®ï¼‰
// ç§»é™¤äº† output: 'export'
// æ·»åŠ äº† experimental.runtime é…ç½®
```

**ç»“æœ**: ç°åœ¨æ”¯æŒåŠ¨æ€ API è·¯ç”±å’Œ Edge Runtime

---

### 2ï¸âƒ£ **app/api/emails/route.ts** âœ… (æ–°å»º)
**åŠŸèƒ½**: é‚®ä»¶æ¥æ”¶å’Œç®¡ç† API

**ç‰¹æ€§**:
- âœ… `export const runtime = 'edge'` - ä½¿ç”¨ Edge Runtime
- âœ… GET è¯·æ±‚ - è·å–é‚®ä»¶åˆ—è¡¨
- âœ… POST è¯·æ±‚ - æ¥æ”¶æ–°é‚®ä»¶
- âœ… DELETE è¯·æ±‚ - åˆ é™¤é‚®ä»¶
- âœ… OPTIONS è¯·æ±‚ - CORS æ”¯æŒ
- âœ… å†…å­˜å­˜å‚¨ - ç”¨äºæœ¬åœ°å¼€å‘
- âœ… å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰

**API ç«¯ç‚¹**:
```
GET    /api/emails?address=xxx@xieziji.shop
POST   /api/emails
DELETE /api/emails?address=xxx&id=yyy
```

---

### 3ï¸âƒ£ **app/api/generate/route.ts** âœ… (æ–°å»º)
**åŠŸèƒ½**: éšæœºé‚®ç®±åœ°å€ç”Ÿæˆ API

**ç‰¹æ€§**:
- âœ… `export const runtime = 'edge'` - ä½¿ç”¨ Edge Runtime
- âœ… POST è¯·æ±‚ - ç”Ÿæˆéšæœºé‚®ç®±
- âœ… æ”¯æŒè‡ªå®šä¹‰å­åŸŸå
- âœ… å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰

**API ç«¯ç‚¹**:
```
POST /api/generate
Body: { "subdomain": "cheyu" }
Response: { "email": "abc123@cheyu.xieziji.shop" }
```

---

### 4ï¸âƒ£ **wrangler.toml** âœ…
**é—®é¢˜**: æ„å»ºè¾“å‡ºç›®å½•é…ç½®é”™è¯¯

**ä¿®å¤**:
```toml
# âŒ ä¹‹å‰
pages_build_output_dir = ".next"

# âœ… ç°åœ¨
pages_build_output_dir = "out"
```

---

### 5ï¸âƒ£ **.nvmrc** âœ… (æ–°å»º)
**åŠŸèƒ½**: æŒ‡å®š Node.js ç‰ˆæœ¬

**å†…å®¹**:
```
20
```

**ç”¨é€”**: ç¡®ä¿ Cloudflare Pages ä½¿ç”¨æ­£ç¡®çš„ Node.js ç‰ˆæœ¬

---

### 6ï¸âƒ£ **email-worker-improved.js** âœ… (æ–°å»º)
**åŠŸèƒ½**: æ”¹è¿›çš„ Cloudflare Email Worker

**ç‰¹æ€§**:
- âœ… æ›´å¥½çš„é”™è¯¯å¤„ç†
- âœ… æ”¯æŒ KV å­˜å‚¨
- âœ… æ”¯æŒ API è½¬å‘
- âœ… å®Œæ•´çš„æ—¥å¿—è®°å½•

---

## ğŸš€ **ç°åœ¨å¯ä»¥åšä»€ä¹ˆï¼Ÿ**

### **æ–¹æ¡ˆ Aï¼šæœ¬åœ°å¼€å‘æµ‹è¯•**

#### æ­¥éª¤ 1: å®‰è£…ä¾èµ–
```bash
npm install
```

**æ³¨æ„**: å¦‚æœé‡åˆ°æƒé™é”™è¯¯ï¼Œè¯·ï¼š
1. ä»¥**ç®¡ç†å‘˜èº«ä»½**è¿è¡Œå‘½ä»¤æç¤ºç¬¦
2. æˆ–è€…å…³é—­æ€æ¯’è½¯ä»¶åé‡è¯•
3. æˆ–è€…ä½¿ç”¨ `yarn install` ä»£æ›¿

#### æ­¥éª¤ 2: å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
npm run dev
```

æˆ–è€…ç›´æ¥åŒå‡» `dev.bat`

#### æ­¥éª¤ 3: è®¿é—®ç½‘ç«™
æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:3000

**åŠŸèƒ½è¯´æ˜**:
- âœ… å‰ç«¯ç•Œé¢å®Œå…¨å¯ç”¨
- âœ… å¯ä»¥ç”Ÿæˆéšæœºé‚®ç®±åœ°å€
- âœ… å¯ä»¥å¤åˆ¶é‚®ç®±åœ°å€
- âš ï¸ é‚®ä»¶æ¥æ”¶åŠŸèƒ½**ä¸ä¼šå·¥ä½œ**ï¼ˆéœ€è¦çœŸå®çš„é‚®ä»¶æœåŠ¡å™¨ï¼‰

---

### **æ–¹æ¡ˆ Bï¼šCloudflare Pages éƒ¨ç½²ï¼ˆå®Œæ•´åŠŸèƒ½ï¼‰**

#### âœ… **ä»£ç å·²æ¨é€åˆ° GitHub**
- Repository: `xieziji9-alt/youxiang-temp-mail`
- Branch: `main`
- Commit: `4ddcf00`

#### ğŸ“‹ **ä¸‹ä¸€æ­¥æ“ä½œ**:

##### 1ï¸âƒ£ **æŸ¥çœ‹ Cloudflare Pages æ„å»ºçŠ¶æ€**
1. æ‰“å¼€ Cloudflare Pages æ§åˆ¶å°
2. æ‰¾åˆ°é¡¹ç›® `youxiang-temp-mail`
3. æŸ¥çœ‹æœ€æ–°çš„éƒ¨ç½²ï¼ˆCommit: `4ddcf00`ï¼‰
4. ç­‰å¾…æ„å»ºå®Œæˆ

**é¢„æœŸç»“æœ**: âœ… æ„å»ºåº”è¯¥ä¼šæˆåŠŸï¼

---

##### 2ï¸âƒ£ **é…ç½® Cloudflare Email Routing**ï¼ˆå¯é€‰ - ç”¨äºçœŸå®é‚®ä»¶æ¥æ”¶ï¼‰

###### A. å¯ç”¨ Email Routing
1. ç™»å½• Cloudflare Dashboard
2. é€‰æ‹©åŸŸå `xieziji.shop`
3. è¿›å…¥ **Email** â†’ **Email Routing**
4. ç‚¹å‡» **Enable Email Routing**

###### B. é…ç½® DNS è®°å½•
Cloudflare ä¼šè‡ªåŠ¨æ·»åŠ ä»¥ä¸‹ DNS è®°å½•ï¼š
```
MX    @    10 route1.mx.cloudflare.net
MX    @    20 route2.mx.cloudflare.net
MX    @    30 route3.mx.cloudflare.net
TXT   @    v=spf1 include:_spf.mx.cloudflare.net ~all
```

###### C. éƒ¨ç½² Email Worker
1. è¿›å…¥ **Workers & Pages** â†’ **Create Application**
2. é€‰æ‹© **Create Worker**
3. å‘½åä¸º `email-worker`
4. å¤åˆ¶ `email-worker.js` çš„å†…å®¹å¹¶ç²˜è´´
5. ç‚¹å‡» **Save and Deploy**

###### D. é…ç½® Email Routing è§„åˆ™
1. å›åˆ° **Email Routing** é¡µé¢
2. ç‚¹å‡» **Routing Rules** â†’ **Create Rule**
3. é…ç½®è§„åˆ™ï¼š
   ```
   Match: *@*.xieziji.shop
   Action: Send to Worker â†’ email-worker
   ```
4. ä¿å­˜è§„åˆ™

---

##### 3ï¸âƒ£ **åˆ›å»º KV å‘½åç©ºé—´**ï¼ˆå¯é€‰ - ç”¨äºæŒä¹…åŒ–å­˜å‚¨ï¼‰

###### A. åˆ›å»º KV å‘½åç©ºé—´
1. è¿›å…¥ **Workers & Pages** â†’ **KV**
2. ç‚¹å‡» **Create Namespace**
3. å‘½åä¸º `EMAIL_STORAGE`
4. è®°å½• KV Namespace IDï¼ˆä¾‹å¦‚: `abc123def456`ï¼‰

###### B. ç»‘å®š KV åˆ° Pages é¡¹ç›®
1. è¿›å…¥ **Pages** â†’ `youxiang-temp-mail`
2. ç‚¹å‡» **Settings** â†’ **Functions**
3. æ‰¾åˆ° **KV Namespace Bindings**
4. æ·»åŠ ç»‘å®šï¼š
   ```
   Variable name: EMAIL_STORAGE
   KV namespace: EMAIL_STORAGE
   ```
5. ä¿å­˜è®¾ç½®

###### C. æ›´æ–° wrangler.tomlï¼ˆå¦‚æœéœ€è¦ï¼‰
ç¼–è¾‘ `wrangler.toml`ï¼Œå–æ¶ˆæ³¨é‡Š KV é…ç½®ï¼š
```toml
[[kv_namespaces]]
binding = "EMAIL_STORAGE"
id = "your-kv-namespace-id"  # æ›¿æ¢ä¸ºå®é™…çš„ ID
```

---

## ğŸ“Š **åŠŸèƒ½å¯¹æ¯”è¡¨**

| åŠŸèƒ½ | æœ¬åœ°å¼€å‘ | Cloudflare Pages (æ—  KV) | Cloudflare Pages (æœ‰ KV) |
|------|---------|-------------------------|-------------------------|
| å‰ç«¯ç•Œé¢ | âœ… | âœ… | âœ… |
| ç”Ÿæˆé‚®ç®± | âœ… | âœ… | âœ… |
| å¤åˆ¶é‚®ç®± | âœ… | âœ… | âœ… |
| æ¥æ”¶é‚®ä»¶ | âŒ | âš ï¸ (å†…å­˜å­˜å‚¨) | âœ… (æŒä¹…åŒ–) |
| é‚®ä»¶åˆ—è¡¨ | âŒ | âš ï¸ (é‡å¯ä¸¢å¤±) | âœ… (24å°æ—¶) |
| åˆ é™¤é‚®ä»¶ | âŒ | âš ï¸ | âœ… |

---

## ğŸ¯ **æ¨èçš„ä½¿ç”¨æµç¨‹**

### **ç«‹å³å¯ç”¨**ï¼ˆæ— éœ€é¢å¤–é…ç½®ï¼‰:
1. âœ… ç­‰å¾… Cloudflare Pages æ„å»ºå®Œæˆ
2. âœ… è®¿é—®éƒ¨ç½²çš„ç½‘ç«™
3. âœ… ä½¿ç”¨å‰ç«¯ç•Œé¢ç”Ÿæˆé‚®ç®±åœ°å€
4. âš ï¸ é‚®ä»¶æ¥æ”¶åŠŸèƒ½éœ€è¦é…ç½® Email Routing

### **å®Œæ•´åŠŸèƒ½**ï¼ˆéœ€è¦é…ç½®ï¼‰:
1. âœ… é…ç½® Cloudflare Email Routing
2. âœ… éƒ¨ç½² Email Worker
3. âœ… åˆ›å»ºå¹¶ç»‘å®š KV å‘½åç©ºé—´
4. âœ… æµ‹è¯•é‚®ä»¶æ¥æ”¶åŠŸèƒ½

---

## ğŸ” **æ•…éšœæ’æŸ¥**

### **é—®é¢˜ 1: Cloudflare Pages æ„å»ºå¤±è´¥**
**æ£€æŸ¥**:
- æŸ¥çœ‹æ„å»ºæ—¥å¿—ä¸­çš„å…·ä½“é”™è¯¯
- ç¡®è®¤ Node.js ç‰ˆæœ¬æ˜¯å¦æ­£ç¡®ï¼ˆåº”è¯¥æ˜¯ 20ï¼‰
- ç¡®è®¤æ‰€æœ‰æ–‡ä»¶éƒ½å·²æ¨é€åˆ° GitHub

**è§£å†³**:
```bash
git status
git add -A
git commit -m "ä¿®å¤æ„å»ºé—®é¢˜"
git push origin main
```

---

### **é—®é¢˜ 2: æœ¬åœ°å¼€å‘ npm install å¤±è´¥**
**åŸå› **: æƒé™é—®é¢˜æˆ–æ€æ¯’è½¯ä»¶æ‹¦æˆª

**è§£å†³æ–¹æ¡ˆ**:
1. **ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ**:
   - å³é”®ç‚¹å‡» "å‘½ä»¤æç¤ºç¬¦"
   - é€‰æ‹© "ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ"
   - å†æ¬¡è¿è¡Œ `npm install`

2. **å…³é—­æ€æ¯’è½¯ä»¶**:
   - ä¸´æ—¶å…³é—­æ€æ¯’è½¯ä»¶
   - è¿è¡Œ `npm install`
   - å®Œæˆåé‡æ–°å¯ç”¨æ€æ¯’è½¯ä»¶

3. **ä½¿ç”¨ yarn**:
   ```bash
   npm install -g yarn
   yarn install
   yarn dev
   ```

---

### **é—®é¢˜ 3: æ”¶ä¸åˆ°é‚®ä»¶**
**æ£€æŸ¥æ¸…å•**:
- [ ] Cloudflare Email Routing æ˜¯å¦å·²å¯ç”¨ï¼Ÿ
- [ ] DNS è®°å½•æ˜¯å¦å·²ç”Ÿæ•ˆï¼Ÿï¼ˆç­‰å¾… 5-10 åˆ†é’Ÿï¼‰
- [ ] Email Worker æ˜¯å¦å·²éƒ¨ç½²ï¼Ÿ
- [ ] Email Routing è§„åˆ™æ˜¯å¦æ­£ç¡®é…ç½®ï¼Ÿ
- [ ] å‘é€çš„é‚®ä»¶åœ°å€æ˜¯å¦åŒ¹é…è§„åˆ™ï¼Ÿï¼ˆ*@*.xieziji.shopï¼‰

---

## ğŸ“ **æ€»ç»“**

### âœ… **å·²å®Œæˆ**:
1. âœ… ä¿®å¤äº†æ‰€æœ‰ TypeScript ç±»å‹é”™è¯¯
2. âœ… ä¿®å¤äº† Next.js é…ç½®é—®é¢˜
3. âœ… åˆ›å»ºäº†å®Œæ•´çš„ API è·¯ç”±
4. âœ… é…ç½®äº† Edge Runtime
5. âœ… æ¨é€åˆ° GitHub
6. âœ… è§¦å‘äº† Cloudflare Pages é‡æ–°æ„å»º

### ğŸ¯ **ä½ ç°åœ¨éœ€è¦åšçš„**:
1. **ç«‹å³**: æŸ¥çœ‹ Cloudflare Pages æ„å»ºçŠ¶æ€
2. **å¯é€‰**: é…ç½® Email Routingï¼ˆå¦‚æœéœ€è¦çœŸå®é‚®ä»¶æ¥æ”¶ï¼‰
3. **å¯é€‰**: æœ¬åœ°æµ‹è¯•å‰ç«¯ç•Œé¢

### ğŸš€ **é¢„æœŸç»“æœ**:
- âœ… Cloudflare Pages æ„å»ºåº”è¯¥ä¼šæˆåŠŸ
- âœ… ç½‘ç«™å¯ä»¥æ­£å¸¸è®¿é—®
- âœ… å‰ç«¯åŠŸèƒ½å®Œå…¨å¯ç”¨
- âš ï¸ é‚®ä»¶æ¥æ”¶éœ€è¦é¢å¤–é…ç½®

---

## ğŸ‰ **æ­å–œï¼é¡¹ç›®å·²ç»å®Œæˆä¿®å¤ï¼**

ç°åœ¨å» Cloudflare Pages æŸ¥çœ‹æ„å»ºçŠ¶æ€å§ï¼ğŸš€

