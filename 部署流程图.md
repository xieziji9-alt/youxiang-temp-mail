# 🗺️ 部署流程图

## 📊 完整部署流程

```
┌─────────────────────────────────────────────────────────────┐
│                     开始部署                                  │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  第一步：配置 GitHub                                          │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  方式1: 双击 setup-github.bat (推荐)                 │   │
│  │  方式2: 手动配置 Git 和创建仓库                       │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
│  输出：                                                       │
│  ✓ Git 已配置                                                │
│  ✓ GitHub 仓库已创建                                         │
│  ✓ 认证已设置                                                │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  第二步：推送代码到 GitHub                                    │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  方式1: 双击 deploy.bat (推荐)                       │   │
│  │  方式2: 使用 GitHub Desktop                          │   │
│  │  方式3: 手动 git 命令                                │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
│  输出：                                                       │
│  ✓ 代码已上传到 GitHub                                       │
│  ✓ 仓库地址: github.com/你的用户名/youxiang-temp-mail        │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  第三步：Cloudflare 配置                                      │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  3.1 登录 Cloudflare                                 │   │
│  │      → dash.cloudflare.com                           │   │
│  │                                                       │   │
│  │  3.2 添加域名                                         │   │
│  │      → 添加站点: xieziji.shop                        │   │
│  │      → 选择 Free 计划                                │   │
│  │      → 修改域名 DNS 服务器                           │   │
│  │                                                       │   │
│  │  3.3 创建 Pages 项目                                 │   │
│  │      → Workers 和 Pages                              │   │
│  │      → 创建应用程序 → Pages                          │   │
│  │      → 连接到 Git → 选择仓库                         │   │
│  │      → 配置构建设置                                   │   │
│  │         框架: Next.js                                │   │
│  │         构建命令: npm run build                      │   │
│  │         输出目录: .next                              │   │
│  │      → 保存并部署                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
│  输出：                                                       │
│  ✓ 网站已部署                                                │
│  ✓ 临时域名: youxiang-temp-mail.pages.dev                   │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  第四步：配置自定义域名                                       │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  4.1 添加主域名                                       │   │
│  │      → 自定义域 → 设置自定义域                       │   │
│  │      → 输入: xieziji.shop                            │   │
│  │      → 激活域                                         │   │
│  │                                                       │   │
│  │  4.2 添加通配符子域名                                 │   │
│  │      → 设置自定义域                                   │   │
│  │      → 输入: *.xieziji.shop                          │   │
│  │      → 激活域                                         │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
│  输出：                                                       │
│  ✓ xieziji.shop 已绑定                                      │
│  ✓ 所有子域名已支持                                          │
│  ✓ HTTPS 自动配置                                           │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  第五步：配置邮件接收                                         │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  5.1 启用 Email Routing                              │   │
│  │      → Email → Email Routing                         │   │
│  │      → 开始使用                                       │   │
│  │      → 自动添加 MX 记录                              │   │
│  │                                                       │   │
│  │  5.2 创建 Email Worker                               │   │
│  │      → Email Workers → 创建                          │   │
│  │      → 复制 email-worker.js 内容                     │   │
│  │      → 保存并部署                                     │   │
│  │                                                       │   │
│  │  5.3 创建路由规则                                     │   │
│  │      → 路由规则 → 创建路由                           │   │
│  │      → 表达式: *@*.xieziji.shop                      │   │
│  │      → 操作: 发送到 Worker                           │   │
│  │                                                       │   │
│  │  5.4 配置 KV 存储                                    │   │
│  │      → Workers 和 Pages → KV                         │   │
│  │      → 创建命名空间: EMAIL_STORAGE                   │   │
│  │      → Pages 项目 → 设置 → 函数                     │   │
│  │      → KV 绑定: EMAIL_STORAGE                        │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
│  输出：                                                       │
│  ✓ 邮件接收已配置                                            │
│  ✓ 邮件存储已设置                                            │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  🎉 部署完成！                                               │
│                                                              │
│  ✅ 可以访问：                                               │
│     • https://xieziji.shop                                  │
│     • https://cheyu.xieziji.shop                            │
│     • https://yumail.xieziji.shop                           │
│     • https://tempmail.xieziji.shop                         │
│     • https://mail.xieziji.shop                             │
│                                                              │
│  ✅ 功能：                                                   │
│     • 生成临时邮箱                                           │
│     • 接收邮件                                               │
│     • 查看邮件内容                                           │
│     • 删除邮件                                               │
└─────────────────────────────────────────────────────────────┘
```

## 🔄 后续更新流程

```
修改代码
    │
    ▼
git add .
    │
    ▼
git commit -m "更新说明"
    │
    ▼
git push
    │
    ▼
Cloudflare 自动检测
    │
    ▼
自动重新构建
    │
    ▼
自动部署
    │
    ▼
网站更新完成！
```

## ⏱️ 时间估算

| 步骤 | 预计时间 | 说明 |
|------|---------|------|
| 配置 GitHub | 5 分钟 | 首次需要注册和配置 |
| 推送代码 | 2 分钟 | 网络速度影响 |
| Cloudflare 配置 | 3 分钟 | 首次需要注册 |
| DNS 生效 | 5-30 分钟 | 自动进行，可以先配置其他 |
| 配置域名 | 2 分钟 | |
| 配置邮件 | 5 分钟 | |
| **总计** | **15-20 分钟** | 不含 DNS 等待时间 |

## 🎯 关键检查点

### ✅ 第一步完成后
- [ ] Git 已安装并配置
- [ ] GitHub 账号已创建
- [ ] GitHub 仓库已创建
- [ ] 认证方式已设置

### ✅ 第二步完成后
- [ ] 代码已推送到 GitHub
- [ ] 可以在 GitHub 网站看到代码

### ✅ 第三步完成后
- [ ] Cloudflare 账号已创建
- [ ] 域名已添加到 Cloudflare
- [ ] DNS 服务器已修改
- [ ] Pages 项目已创建
- [ ] 构建成功
- [ ] 可以访问 .pages.dev 域名

### ✅ 第四步完成后
- [ ] 自定义域名已添加
- [ ] 通配符域名已添加
- [ ] DNS 记录已自动配置
- [ ] 可以访问 xieziji.shop

### ✅ 第五步完成后
- [ ] Email Routing 已启用
- [ ] MX 记录已配置
- [ ] Email Worker 已部署
- [ ] 路由规则已创建
- [ ] KV 存储已创建并绑定
- [ ] 可以接收邮件

## 🚨 常见卡点

### 卡点 1: Git 推送失败
**原因：** 认证未配置
**解决：** 运行 setup-github.bat 配置 Personal Access Token

### 卡点 2: Cloudflare 构建失败
**原因：** Node.js 版本不对
**解决：** 在构建设置中设置环境变量 `NODE_VERSION=18`

### 卡点 3: 域名无法访问
**原因：** DNS 未生效
**解决：** 等待 5-30 分钟，最多 24 小时

### 卡点 4: 收不到邮件
**原因：** Email Worker 或 KV 未配置
**解决：** 检查第五步的每个子步骤

## 📞 需要帮助？

遇到问题时：
1. 查看 `一键部署指南.md` 的常见问题部分
2. 检查 Cloudflare 控制台的错误信息
3. 查看浏览器开发者工具（F12）的 Console

---

**祝你部署顺利！** 🎉

